<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>vueåŸç†mvvmå®ç° | slc3a2</title>
<meta name=keywords content="å‰ç«¯"><meta name=description content='index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app">
      <input type="text" v-model="v" />
      {{v}}
      <button @click="reset">é‡ç½®</button>
    </div>
    <script src="./index.js"></script>
    <script>
      const vm = new Mvvm({
        el: "#app",
        data: {
          v: "hello world",
        },
        methods: {
          reset() {
            this.v = "";
          },
        },
      });
    </script>
  </body>
</html>
index.js
class Mvvm {
  constructor(options) {
    const { el, data, methods } = options;
    this.methods = methods;
    this.target = null;
    // ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª
    this.observe(this, data);
    // domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click
    this.compile(document.querySelector(el));
  }

  // æ•°æ®å˜åŒ–ç›‘å¬
  observe(_this, data) {
    Object.keys(data).forEach((key) => {
      let val = data[key];
      Object.keys(data).forEach((key) => {
        // å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬
        if (typeof val === "object") {
          return this.observe(_this, val);
        }
        // dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨
        const dispatcher = new Dispatcher();
        Object.defineProperty(_this, key, {
          get: function () {
            console.log("get");
            // this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom
            dispatcher.add(this.target);
            return val;
          },
          set: function (newV) {
            // å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç†
            if (newV === val) {
              return;
            }
            console.log(`set`);
            val = newV;
            // å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV
            dispatcher.notify(newV);
          },
        });
      });
    });
  }

  // domè§£æ
  compile(dom) {
    const childs = dom.childNodes;
    for (const node of childs) {
      // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
      if (node.nodeType === 1) {
        const attrs = node.attributes;
        for (const attr of attrs) {
          if (attr.name === "v-model") {
            const name = attr.value;
            // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
            this.target = new Watcher(node, "input");
            // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
            this[name];
            // ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ
            node.addEventListener("input", (e) => {
              this[name] = e.target.value;
            });
          }
          // ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶
          if (attr.name === "@click") {
            const name = attr.value;
            node.addEventListener("click", this.methods[name].bind(this));
          }
        }
      }
      // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
      if (node.nodeType === 3) {
        // æ­£åˆ™åŒ¹é…{{}}
        const reg = /\{\{(.*)\}\}/;
        const match = node.nodeValue.match(reg);
        if (match) {
          const name = match[1].trim();
          // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
          this.target = new Watcher(node, "text");
          // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
          this[name];
        }
      }
    }
  }
}

// å‘å¸ƒè€…
class Dispatcher {
  constructor() {
    this.watchers = [];
  }
  // å¢åŠ è®¢é˜…è€…
  add(watcher) {
    this.watchers.push(watcher);
  }
  // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–°
  notify(value) {
    this.watchers.forEach((item) => {
      item.update(value);
    });
  }
}

// è®¢é˜…è€…
class Watcher {
  constructor(node, type) {
    this.node = node;
    this.type = type;
  }
  update(value) {
    // åŒºåˆ«domç±»å‹æ¥èµ‹å€¼
    if (this.type === "input") {
      this.node.value = value;
    }
    if (this.type === "text") {
      this.node.nodeValue = value;
    }
  }
}
vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ Observe å‡½æ•°æŠŠ data åˆ©ç”¨ Object.defineProperty å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ Compile å‡½æ•°å¾ªç¯ domï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ Observer çš„ set (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ Watcher è°ƒç”¨ update æ–¹æ³•ã€‚'><meta name=author content="slc3a2"><link rel=canonical href=https://slc3a2.github.io/blogs/vue%E5%8E%9F%E7%90%86mvvm%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/><link crossorigin=anonymous href=/assets/css/stylesheet.03380b421b43a59cef22aa8ddc67c8077da9081a7c7a95ef8104001f8af6ac13.css integrity="sha256-AzgLQhtDpZzvIqqN3GfIB32pCBp8epXvgQQAH4r2rBM=" rel="preload stylesheet" as=style><link rel=icon href=https://slc3a2.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://slc3a2.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://slc3a2.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://slc3a2.github.io/apple-touch-icon.png><link rel=mask-icon href=https://slc3a2.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=zh href=https://slc3a2.github.io/blogs/vue%E5%8E%9F%E7%90%86mvvm%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://slc3a2.github.io/blogs/vue%E5%8E%9F%E7%90%86mvvm%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/"><meta property="og:site_name" content="slc3a2"><meta property="og:title" content="vueåŸç†mvvmå®ç°"><meta property="og:description" content='index.html <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>Document</title> </head> <body> <div id="app"> <input type="text" v-model="v" /> {{v}} <button @click="reset">é‡ç½®</button> </div> <script src="./index.js"></script> <script> const vm = new Mvvm({ el: "#app", data: { v: "hello world", }, methods: { reset() { this.v = ""; }, }, }); </script> </body> </html> index.js class Mvvm { constructor(options) { const { el, data, methods } = options; this.methods = methods; this.target = null; // ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª this.observe(this, data); // domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click this.compile(document.querySelector(el)); } // æ•°æ®å˜åŒ–ç›‘å¬ observe(_this, data) { Object.keys(data).forEach((key) => { let val = data[key]; Object.keys(data).forEach((key) => { // å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬ if (typeof val === "object") { return this.observe(_this, val); } // dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨ const dispatcher = new Dispatcher(); Object.defineProperty(_this, key, { get: function () { console.log("get"); // this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom dispatcher.add(this.target); return val; }, set: function (newV) { // å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç† if (newV === val) { return; } console.log(`set`); val = newV; // å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV dispatcher.notify(newV); }, }); }); }); } // domè§£æ compile(dom) { const childs = dom.childNodes; for (const node of childs) { // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 1) { const attrs = node.attributes; for (const attr of attrs) { if (attr.name === "v-model") { const name = attr.value; // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, "input"); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; // ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ node.addEventListener("input", (e) => { this[name] = e.target.value; }); } // ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶ if (attr.name === "@click") { const name = attr.value; node.addEventListener("click", this.methods[name].bind(this)); } } } // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 3) { // æ­£åˆ™åŒ¹é…{{}} const reg = /\{\{(.*)\}\}/; const match = node.nodeValue.match(reg); if (match) { const name = match[1].trim(); // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, "text"); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; } } } } } // å‘å¸ƒè€… class Dispatcher { constructor() { this.watchers = []; } // å¢åŠ è®¢é˜…è€… add(watcher) { this.watchers.push(watcher); } // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–° notify(value) { this.watchers.forEach((item) => { item.update(value); }); } } // è®¢é˜…è€… class Watcher { constructor(node, type) { this.node = node; this.type = type; } update(value) { // åŒºåˆ«domç±»å‹æ¥èµ‹å€¼ if (this.type === "input") { this.node.value = value; } if (this.type === "text") { this.node.nodeValue = value; } } } vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ Observe å‡½æ•°æŠŠ data åˆ©ç”¨ Object.defineProperty å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ Compile å‡½æ•°å¾ªç¯ domï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ Observer çš„ set (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ Watcher è°ƒç”¨ update æ–¹æ³•ã€‚'><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="blogs"><meta property="article:published_time" content="2020-10-27T18:46:33+08:00"><meta property="article:modified_time" content="2020-10-27T18:46:33+08:00"><meta property="article:tag" content="å‰ç«¯"><meta property="og:image" content="https://slc3a2.github.io/images/%E5%91%BD%E9%A2%98%E9%80%BB%E8%BE%91%E7%9C%9F%E5%80%BC%E8%A1%A8/cover.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://slc3a2.github.io/images/%E5%91%BD%E9%A2%98%E9%80%BB%E8%BE%91%E7%9C%9F%E5%80%BC%E8%A1%A8/cover.jpg"><meta name=twitter:title content="vueåŸç†mvvmå®ç°"><meta name=twitter:description content='index.html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <div id="app">
      <input type="text" v-model="v" />
      {{v}}
      <button @click="reset">é‡ç½®</button>
    </div>
    <script src="./index.js"></script>
    <script>
      const vm = new Mvvm({
        el: "#app",
        data: {
          v: "hello world",
        },
        methods: {
          reset() {
            this.v = "";
          },
        },
      });
    </script>
  </body>
</html>
index.js
class Mvvm {
  constructor(options) {
    const { el, data, methods } = options;
    this.methods = methods;
    this.target = null;
    // ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª
    this.observe(this, data);
    // domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click
    this.compile(document.querySelector(el));
  }

  // æ•°æ®å˜åŒ–ç›‘å¬
  observe(_this, data) {
    Object.keys(data).forEach((key) => {
      let val = data[key];
      Object.keys(data).forEach((key) => {
        // å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬
        if (typeof val === "object") {
          return this.observe(_this, val);
        }
        // dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨
        const dispatcher = new Dispatcher();
        Object.defineProperty(_this, key, {
          get: function () {
            console.log("get");
            // this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom
            dispatcher.add(this.target);
            return val;
          },
          set: function (newV) {
            // å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç†
            if (newV === val) {
              return;
            }
            console.log(`set`);
            val = newV;
            // å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV
            dispatcher.notify(newV);
          },
        });
      });
    });
  }

  // domè§£æ
  compile(dom) {
    const childs = dom.childNodes;
    for (const node of childs) {
      // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
      if (node.nodeType === 1) {
        const attrs = node.attributes;
        for (const attr of attrs) {
          if (attr.name === "v-model") {
            const name = attr.value;
            // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
            this.target = new Watcher(node, "input");
            // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
            this[name];
            // ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ
            node.addEventListener("input", (e) => {
              this[name] = e.target.value;
            });
          }
          // ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶
          if (attr.name === "@click") {
            const name = attr.value;
            node.addEventListener("click", this.methods[name].bind(this));
          }
        }
      }
      // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
      if (node.nodeType === 3) {
        // æ­£åˆ™åŒ¹é…{{}}
        const reg = /\{\{(.*)\}\}/;
        const match = node.nodeValue.match(reg);
        if (match) {
          const name = match[1].trim();
          // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
          this.target = new Watcher(node, "text");
          // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
          this[name];
        }
      }
    }
  }
}

// å‘å¸ƒè€…
class Dispatcher {
  constructor() {
    this.watchers = [];
  }
  // å¢åŠ è®¢é˜…è€…
  add(watcher) {
    this.watchers.push(watcher);
  }
  // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–°
  notify(value) {
    this.watchers.forEach((item) => {
      item.update(value);
    });
  }
}

// è®¢é˜…è€…
class Watcher {
  constructor(node, type) {
    this.node = node;
    this.type = type;
  }
  update(value) {
    // åŒºåˆ«domç±»å‹æ¥èµ‹å€¼
    if (this.type === "input") {
      this.node.value = value;
    }
    if (this.type === "text") {
      this.node.nodeValue = value;
    }
  }
}
vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ Observe å‡½æ•°æŠŠ data åˆ©ç”¨ Object.defineProperty å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ Compile å‡½æ•°å¾ªç¯ domï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ Observer çš„ set (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ Watcher è°ƒç”¨ update æ–¹æ³•ã€‚'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"æ—¥å¿—","item":"https://slc3a2.github.io/blogs/"},{"@type":"ListItem","position":2,"name":"vueåŸç†mvvmå®ç°","item":"https://slc3a2.github.io/blogs/vue%E5%8E%9F%E7%90%86mvvm%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"vueåŸç†mvvmå®ç°","name":"vueåŸç†mvvmå®ç°","description":"index.html \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34; /\u0026gt; \u0026lt;meta name=\u0026#34;viewport\u0026#34; content=\u0026#34;width=device-width, initial-scale=1.0\u0026#34; /\u0026gt; \u0026lt;title\u0026gt;Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026#34;app\u0026#34;\u0026gt; \u0026lt;input type=\u0026#34;text\u0026#34; v-model=\u0026#34;v\u0026#34; /\u0026gt; {{v}} \u0026lt;button @click=\u0026#34;reset\u0026#34;\u0026gt;é‡ç½®\u0026lt;/button\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;script src=\u0026#34;./index.js\u0026#34;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script\u0026gt; const vm = new Mvvm({ el: \u0026#34;#app\u0026#34;, data: { v: \u0026#34;hello world\u0026#34;, }, methods: { reset() { this.v = \u0026#34;\u0026#34;; }, }, }); \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; index.js class Mvvm { constructor(options) { const { el, data, methods } = options; this.methods = methods; this.target = null; // ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª this.observe(this, data); // domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click this.compile(document.querySelector(el)); } // æ•°æ®å˜åŒ–ç›‘å¬ observe(_this, data) { Object.keys(data).forEach((key) =\u0026gt; { let val = data[key]; Object.keys(data).forEach((key) =\u0026gt; { // å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬ if (typeof val === \u0026#34;object\u0026#34;) { return this.observe(_this, val); } // dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨ const dispatcher = new Dispatcher(); Object.defineProperty(_this, key, { get: function () { console.log(\u0026#34;get\u0026#34;); // this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom dispatcher.add(this.target); return val; }, set: function (newV) { // å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç† if (newV === val) { return; } console.log(`set`); val = newV; // å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV dispatcher.notify(newV); }, }); }); }); } // domè§£æ compile(dom) { const childs = dom.childNodes; for (const node of childs) { // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 1) { const attrs = node.attributes; for (const attr of attrs) { if (attr.name === \u0026#34;v-model\u0026#34;) { const name = attr.value; // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, \u0026#34;input\u0026#34;); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; // ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ node.addEventListener(\u0026#34;input\u0026#34;, (e) =\u0026gt; { this[name] = e.target.value; }); } // ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶ if (attr.name === \u0026#34;@click\u0026#34;) { const name = attr.value; node.addEventListener(\u0026#34;click\u0026#34;, this.methods[name].bind(this)); } } } // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 3) { // æ­£åˆ™åŒ¹é…{{}} const reg = /\\{\\{(.*)\\}\\}/; const match = node.nodeValue.match(reg); if (match) { const name = match[1].trim(); // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, \u0026#34;text\u0026#34;); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; } } } } } // å‘å¸ƒè€… class Dispatcher { constructor() { this.watchers = []; } // å¢åŠ è®¢é˜…è€… add(watcher) { this.watchers.push(watcher); } // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–° notify(value) { this.watchers.forEach((item) =\u0026gt; { item.update(value); }); } } // è®¢é˜…è€… class Watcher { constructor(node, type) { this.node = node; this.type = type; } update(value) { // åŒºåˆ«domç±»å‹æ¥èµ‹å€¼ if (this.type === \u0026#34;input\u0026#34;) { this.node.value = value; } if (this.type === \u0026#34;text\u0026#34;) { this.node.nodeValue = value; } } } vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ Observe å‡½æ•°æŠŠ data åˆ©ç”¨ Object.defineProperty å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ Compile å‡½æ•°å¾ªç¯ domï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ Observer çš„ set (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ Watcher è°ƒç”¨ update æ–¹æ³•ã€‚\n","keywords":["å‰ç«¯"],"articleBody":"index.html \u003c!DOCTYPE html\u003e \u003chtml lang=\"en\"\u003e \u003chead\u003e \u003cmeta charset=\"UTF-8\" /\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" /\u003e \u003ctitle\u003eDocument\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cdiv id=\"app\"\u003e \u003cinput type=\"text\" v-model=\"v\" /\u003e {{v}} \u003cbutton @click=\"reset\"\u003eé‡ç½®\u003c/button\u003e \u003c/div\u003e \u003cscript src=\"./index.js\"\u003e\u003c/script\u003e \u003cscript\u003e const vm = new Mvvm({ el: \"#app\", data: { v: \"hello world\", }, methods: { reset() { this.v = \"\"; }, }, }); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003e index.js class Mvvm { constructor(options) { const { el, data, methods } = options; this.methods = methods; this.target = null; // ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª this.observe(this, data); // domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click this.compile(document.querySelector(el)); } // æ•°æ®å˜åŒ–ç›‘å¬ observe(_this, data) { Object.keys(data).forEach((key) =\u003e { let val = data[key]; Object.keys(data).forEach((key) =\u003e { // å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬ if (typeof val === \"object\") { return this.observe(_this, val); } // dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨ const dispatcher = new Dispatcher(); Object.defineProperty(_this, key, { get: function () { console.log(\"get\"); // this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom dispatcher.add(this.target); return val; }, set: function (newV) { // å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç† if (newV === val) { return; } console.log(`set`); val = newV; // å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV dispatcher.notify(newV); }, }); }); }); } // domè§£æ compile(dom) { const childs = dom.childNodes; for (const node of childs) { // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 1) { const attrs = node.attributes; for (const attr of attrs) { if (attr.name === \"v-model\") { const name = attr.value; // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, \"input\"); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; // ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ node.addEventListener(\"input\", (e) =\u003e { this[name] = e.target.value; }); } // ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶ if (attr.name === \"@click\") { const name = attr.value; node.addEventListener(\"click\", this.methods[name].bind(this)); } } } // nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp if (node.nodeType === 3) { // æ­£åˆ™åŒ¹é…{{}} const reg = /\\{\\{(.*)\\}\\}/; const match = node.nodeValue.match(reg); if (match) { const name = match[1].trim(); // æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­ this.target = new Watcher(node, \"text\"); // this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬ this[name]; } } } } } // å‘å¸ƒè€… class Dispatcher { constructor() { this.watchers = []; } // å¢åŠ è®¢é˜…è€… add(watcher) { this.watchers.push(watcher); } // é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–° notify(value) { this.watchers.forEach((item) =\u003e { item.update(value); }); } } // è®¢é˜…è€… class Watcher { constructor(node, type) { this.node = node; this.type = type; } update(value) { // åŒºåˆ«domç±»å‹æ¥èµ‹å€¼ if (this.type === \"input\") { this.node.value = value; } if (this.type === \"text\") { this.node.nodeValue = value; } } } vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ Observe å‡½æ•°æŠŠ data åˆ©ç”¨ Object.defineProperty å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ Compile å‡½æ•°å¾ªç¯ domï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª Watcher å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ Observer çš„ set (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ Watcher è°ƒç”¨ update æ–¹æ³•ã€‚\n","wordCount":"1121","inLanguage":"zh","image":"https://slc3a2.github.io/images/%E5%91%BD%E9%A2%98%E9%80%BB%E8%BE%91%E7%9C%9F%E5%80%BC%E8%A1%A8/cover.jpg","datePublished":"2020-10-27T18:46:33+08:00","dateModified":"2020-10-27T18:46:33+08:00","author":{"@type":"Person","name":"slc3a2"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://slc3a2.github.io/blogs/vue%E5%8E%9F%E7%90%86mvvm%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/"},"publisher":{"@type":"Organization","name":"slc3a2","logo":{"@type":"ImageObject","url":"https://slc3a2.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://slc3a2.github.io/ accesskey=h title="slc3a2 (Alt + H)">slc3a2</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://slc3a2.github.io/ title="ğŸ  é¦–é¡µ"><span>ğŸ  é¦–é¡µ</span></a></li><li><a href=https://slc3a2.github.io/blogs/ title="ğŸ“š æ—¥å¿—"><span>ğŸ“š æ—¥å¿—</span></a></li><li><a href=https://slc3a2.github.io/apps/ title="ğŸš€ åº”ç”¨"><span>ğŸš€ åº”ç”¨</span></a></li><li><a href=https://slc3a2.github.io/search/ title="ğŸ” æœç´¢"><span>ğŸ” æœç´¢</span></a></li><li><a href=https://slc3a2.github.io/tags/ title="ğŸ§© åˆ†ç±»"><span>ğŸ§© åˆ†ç±»</span></a></li><li><a href=https://slc3a2.github.io/archives/ title="â± æ—¶é—´è½´"><span>â± æ—¶é—´è½´</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">vueåŸç†mvvmå®ç°</h1><div class=post-meta><span title='2020-10-27 18:46:33 +0800 CST'>2020-10-27</span>&nbsp; ï½œ &nbsp;3 åˆ†é’Ÿ&nbsp; ï½œ &nbsp;1121 å­—&nbsp; ï½œ &nbsp;slc3a2</div></header><figure class=entry-cover1><img loading=eager src=https://slc3a2.github.io/images/%E5%91%BD%E9%A2%98%E9%80%BB%E8%BE%91%E7%9C%9F%E5%80%BC%E8%A1%A8/cover.jpg alt="cover image"><figcaption>å°é¢å›¾æ¥è‡ª Unsplash | ä½œè€… Jakob Owens</figcaption></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>ç›®å½•</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#indexhtml>index.html</a></li><li><a href=#indexjs>index.js</a></li></ul></nav></div></details></div><div class=post-content><h2 id=indexhtml>index.html<a hidden class=anchor aria-hidden=true href=#indexhtml>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#75715e>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>html</span> <span style=color:#a6e22e>lang</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>title</span>&gt;Document&lt;/<span style=color:#f92672>title</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;app&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>input</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text&#34;</span> <span style=color:#a6e22e>v-model</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;v&#34;</span> /&gt;
</span></span><span style=display:flex><span>      {{v}}
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>button</span> <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#a6e22e>click</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;reset&#34;</span>&gt;é‡ç½®&lt;/<span style=color:#f92672>button</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;./index.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>vm</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Mvvm</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;#app&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>v</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;hello world&#34;</span>,
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>methods</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>reset</span>() {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>v</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#f92672>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>html</span>&gt;
</span></span></code></pre></div><h2 id=indexjs>index.js<a hidden class=anchor aria-hidden=true href=#indexjs>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Mvvm</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>options</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>el</span>, <span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>methods</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>options</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>methods</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>methods</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ç›‘å¬this[dataçš„key]æ‰€æœ‰å±æ€§ï¼Œè®©å˜åŒ–å¯è¿½è¸ª
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>observe</span>(<span style=color:#66d9ef>this</span>, <span style=color:#a6e22e>data</span>);
</span></span><span style=display:flex><span>    <span style=color:#75715e>// domè§£æï¼šæå–{{}}ã€v-modelã€äº‹ä»¶é‡å†™ï¼š@click
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>compile</span>(document.<span style=color:#a6e22e>querySelector</span>(<span style=color:#a6e22e>el</span>));
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// æ•°æ®å˜åŒ–ç›‘å¬
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>observe</span>(<span style=color:#a6e22e>_this</span>, <span style=color:#a6e22e>data</span>) {
</span></span><span style=display:flex><span>    Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>data</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>key</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>key</span>];
</span></span><span style=display:flex><span>      Object.<span style=color:#a6e22e>keys</span>(<span style=color:#a6e22e>data</span>).<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>key</span>) =&gt; {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// å¦‚æœvalæ˜¯æ•°ç»„æˆ–è€…å¯¹è±¡ï¼Œä½¿ç”¨é€’å½’å®ç°æ·±å±‚ç›‘å¬ï¼Œç›´åˆ°valä¸ºç®€å•æ•°æ®ç±»å‹ã€‚ä»è€Œä¿è¯æ‰€æœ‰å±æ€§å˜åŒ–éƒ½è¢«ç›‘å¬
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>val</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;object&#34;</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>observe</span>(<span style=color:#a6e22e>_this</span>, <span style=color:#a6e22e>val</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// dispatcherç”¨æ¥æ“ä½œè®¢é˜…è€…(watcher) add æˆ–è€… updateã€‚è¦é…åˆObject.definePropertyçš„getå’Œsetæ¥ä½¿ç”¨
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>dispatcher</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Dispatcher</span>();
</span></span><span style=display:flex><span>        Object.<span style=color:#a6e22e>defineProperty</span>(<span style=color:#a6e22e>_this</span>, <span style=color:#a6e22e>key</span>, {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>get</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;get&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// this.targetä¼šåœ¨compileæ–¹æ³•ä¸­å‡ºç°ï¼ŒæŠŠthis.target(ä¸€ä¸ªwatcher)æ·»åŠ åˆ°dispatcher(å°†è¦æ›´æ–°çš„watcherçš„åˆ—è¡¨)ä¸­ï¼Œç”¨äºæœªæ¥æ›´æ–°è¿™ä¸ªwatcherå¯¹åº”çš„dom
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>dispatcher</span>.<span style=color:#a6e22e>add</span>(<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>target</span>);
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>val</span>;
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>set</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>newV</span>) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å€¼æ— å˜åŒ–ï¼Œä¸å¤„ç†
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>newV</span> <span style=color:#f92672>===</span> <span style=color:#a6e22e>val</span>) {
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`set`</span>);
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>val</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>newV</span>;
</span></span><span style=display:flex><span>            <span style=color:#75715e>// å› ä¸ºsetäº†ï¼Œå€¼å‘ç”Ÿå˜åŒ–äº†ï¼Œæ‰€ä»¥è¦é€šçŸ¥getä¸­æ·»åŠ çš„æ‰€æœ‰è®¢é˜…è€…(watcher)ï¼šä½ ä»¬è¦æŠŠå¯¹åº”çš„domä¸­ä½¿ç”¨çš„å€¼æ›´æ–°æˆnewV
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>dispatcher</span>.<span style=color:#a6e22e>notify</span>(<span style=color:#a6e22e>newV</span>);
</span></span><span style=display:flex><span>          },
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>// domè§£æ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>compile</span>(<span style=color:#a6e22e>dom</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>childs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>dom</span>.<span style=color:#a6e22e>childNodes</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>node</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>childs</span>) {
</span></span><span style=display:flex><span>      <span style=color:#75715e>// nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>nodeType</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attrs</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>attributes</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>attr</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>attrs</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>attr</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;v-model&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>attr</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>            <span style=color:#75715e>// æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Watcher</span>(<span style=color:#a6e22e>node</span>, <span style=color:#e6db74>&#34;input&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#75715e>// this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>this</span>[<span style=color:#a6e22e>name</span>];
</span></span><span style=display:flex><span>            <span style=color:#75715e>// ç”±äºæ˜¯demoï¼Œå‡è®¾åªæœ‰inputä¸€ç§æƒ…å†µï¼Œinputå°±ä¼šæœ‰åŒå‘ç»‘å®šã€‚ä½¿ç”¨this[name], å¹¶ä¸”èµ‹å€¼inputçš„å€¼ï¼Œæ¥è§¦å‘observeçš„getã€‚å®ç°æ›´æ–°ä¿¡æ¯çš„å‘å¸ƒ
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;input&#34;</span>, (<span style=color:#a6e22e>e</span>) =&gt; {
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>this</span>[<span style=color:#a6e22e>name</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>e</span>.<span style=color:#a6e22e>target</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>            });
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          <span style=color:#75715e>// ä½¿ç”¨bindä¼ é€’thisã€‚å¹¶ä»£ç†clickäº‹ä»¶å‡½æ•°åˆ°@clickä¸Šã€‚è¿™é‡Œä»…æ‹¿clickäº‹ä»¶å®ç°ï¼Œå®é™…ä¼šæœ‰å¤šç§äº‹ä»¶
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>attr</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;@click&#34;</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>attr</span>.<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;click&#34;</span>, <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>methods</span>[<span style=color:#a6e22e>name</span>].<span style=color:#a6e22e>bind</span>(<span style=color:#66d9ef>this</span>));
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      <span style=color:#75715e>// nodeType å‚è€ƒ https://www.w3school.com.cn/jsref/prop_node_nodetype.asp
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>nodeType</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>3</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ­£åˆ™åŒ¹é…{{}}
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>reg</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>/\{\{(.*)\}\}/</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>match</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>nodeValue</span>.<span style=color:#a6e22e>match</span>(<span style=color:#a6e22e>reg</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>match</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>match</span>[<span style=color:#ae81ff>1</span>].<span style=color:#a6e22e>trim</span>();
</span></span><span style=display:flex><span>          <span style=color:#75715e>// æ”¾åˆ°è®¢é˜…è€…åˆ—è¡¨ä¸­
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>target</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Watcher</span>(<span style=color:#a6e22e>node</span>, <span style=color:#e6db74>&#34;text&#34;</span>);
</span></span><span style=display:flex><span>          <span style=color:#75715e>// this[name]æ˜¯ä¸ºäº†è§¦å‘observeçš„getï¼Œæ‰ä¼šè¢«ç›‘å¬
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>this</span>[<span style=color:#a6e22e>name</span>];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å‘å¸ƒè€…
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Dispatcher</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>watchers</span> <span style=color:#f92672>=</span> [];
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// å¢åŠ è®¢é˜…è€…
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>add</span>(<span style=color:#a6e22e>watcher</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>watchers</span>.<span style=color:#a6e22e>push</span>(<span style=color:#a6e22e>watcher</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#75715e>// é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…æ›´æ–°
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>notify</span>(<span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>watchers</span>.<span style=color:#a6e22e>forEach</span>((<span style=color:#a6e22e>item</span>) =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>value</span>);
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// è®¢é˜…è€…
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Watcher</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>constructor</span>(<span style=color:#a6e22e>node</span>, <span style=color:#a6e22e>type</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>node</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>node</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>type</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>update</span>(<span style=color:#a6e22e>value</span>) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// åŒºåˆ«domç±»å‹æ¥èµ‹å€¼
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;input&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;text&#34;</span>) {
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>this</span>.<span style=color:#a6e22e>node</span>.<span style=color:#a6e22e>nodeValue</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>vue åœ¨åˆå§‹åŒ–åï¼Œæ‰§è¡Œ <strong>Observe</strong> å‡½æ•°æŠŠ data åˆ©ç”¨ <strong>Object.defineProperty</strong> å±æ€§ç›‘å¬ã€‚åŒæ—¶ä¹Ÿä¼šä½¿ç”¨ <strong>Compile</strong> å‡½æ•°<strong>å¾ªç¯ dom</strong>ï¼Œæå– vue ç›¸å…³çš„å…³é”®å­—ï¼Œv-bind æˆ–è€… v-modelï¼Œæ‰¾åˆ°è¿™äº›å€¼ï¼Œæ–°å»ºä¸€ä¸ª <strong>Watcher</strong> å®ä¾‹ï¼Œç„¶åæ‰‹åŠ¨ get ä½¿è¿™äº› watch æ”¾å…¥ dep åˆ—è¡¨ä¸­ç­‰å¾…è®¢é˜…ã€‚ç­‰å¾…è°ƒç”¨ <strong>Observer</strong> çš„ <strong>set</strong> (input äº‹ä»¶ï¼Œæˆ–è€…æ‰‹åŠ¨èµ‹å€¼)ï¼Œç„¶åé€šçŸ¥ dep ä¸­æ‰€æœ‰ <strong>Watcher</strong> è°ƒç”¨ <strong>update</strong> æ–¹æ³•ã€‚</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://slc3a2.github.io/tags/%E5%89%8D%E7%AB%AF/>å‰ç«¯</a></li></ul><nav class=paginav><a class=prev href=https://slc3a2.github.io/blogs/promise%E7%AE%80%E5%8D%95%E5%AE%9E%E7%8E%B0/><span class=title>Â« ä¸Šä¸€é¡µ</span><br><span>promsieçš„å®ç°</span>
</a><a class=next href=https://slc3a2.github.io/blogs/%E4%BD%BF%E7%94%A8jarsigner%E9%87%8D%E6%96%B0%E7%AD%BE%E5%90%8Dapk%E5%8C%85/><span class=title>ä¸‹ä¸€é¡µ Â»</span><br><span>ä½¿ç”¨jarsigneré‡æ–°ç­¾åapkåŒ…</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://slc3a2.github.io/>slc3a2</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="å¤åˆ¶";function s(){t.innerHTML="å·²å¤åˆ¶ï¼",setTimeout(()=>{t.innerHTML="å¤åˆ¶"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>